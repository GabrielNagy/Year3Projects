{% extends "layout.html" %}
{% block content %}
<div class="container">
  <div class="panel panel-default">
    <div class="panel-heading">
      {% if session.logged_in %}
      <div class="panel-title pull-left">Please upload a file.</div>
      <div class="pull-right">logged in as <em>{{ session.username }}</em> <small><a href="{{ url_for('generate_rankings') }}">(rankings)</a> | <a href="{{ url_for('logout') }}">(logout)</a></small></div>
      {% else %}
      <div class="pull-right"><small><a href="{{ url_for('login') }}">(login)</a> | <a href="{{ url_for('register') }}">(register)</a> | <a href="{{ url_for('generate_rankings') }}">(rankings)</a></small></div>
      {% endif %}
      <div class="clearfix"></div>
    </div>
    <div class="panel-body">
      {% include "utils/flasher.html" %}
      {% if session.logged_in %}
      <form action="{{ url_for('add_entry') }}" method=post enctype=multipart/form-data>
        <div class="row">
        <div class="col-xs-6 form-group">
          <label class="control-label" for="file-source">Upload source file:</label>
          <!-- <div class="col-sm-10"> -->
            <label class="btn btn-default"><input type="file" name="file-source" hidden></label>
          <!-- </div> -->
        </div>
        <div class="col-xs-6 form-group">
          <label class="control-label" for="file-header">Upload header file (if applicable):</label>
          <!-- <div class="col-sm-10"> -->
            <label class="btn btn-default"><input type="file" name="file-header" hidden></label>
          <!-- </div> -->
        </div>
        <div class="col-xs-6 form-group">
          <label class="control-label" for="language">Select programming language:</label>
          <!-- <div class="col-sm-10"> -->
          <select class="form-control" name="language">
            <option value="cpp">C++</option>
            <option value="c">C</option>
            <option value="pas">Pascal</option>
            <option value="java">Java</option>
            </select>
          <!-- </div> -->
        </div>
        <div class="col-xs-6 form-group">
          <label class="control-label" for="problem">Select problem:</label>
          <!-- <div class="col-sm-10"> -->
          <select class="form-control" name="problem">
            <option value="kfib">Problem 1: Kfib</option>
            <option value="dijkstra">Problem 2: Dijkstra</option>
            <option value="p3">Problem 3</option>
            </select>
          <!-- </div> -->
        </div>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-default">Submit</button>
          </div>
        </div>
        </div>
      </form>
    </div>
  </div>
  {% for file in files %}
  <hr />
  <div class="panel panel-primary">
    <div class="panel-heading clearfix">
      <h4 class="panel-title pull-left" style="padding-top: 7.5px;"><a href="{{ url_for('uploads', path=file.id, filename=file.value[0])}}">{{ file.value[0] }}</a> <small>(problem: {{ file.value[1] }}) (language: {{ file.value[2] }}) (id: {{ file.id }})</small></h4>
      <div class="pull-right">
        {% if file.value[3] %}
        <button onclick="location.href = '{{ url_for('delete_file', path=file.id) }}';" class="btn btn-danger">Delete item</button>
        {% else %}
        <button onclick="start_task('{{file.id}}');" class="btn btn-default">Test</button>
        <button onclick="location.href = '{{ url_for('delete_file', path=file.id) }}';" class="btn btn-danger">Delete item</button>
        {% endif %}
      </div>
    </div>
    <div class="panel-body">
      {% if file.value[3] %}
    <pre>{{ file.value[3] }}</pre>
    {% else %}
    <div id="progress-{{file.id}}"></div>
    {% endif %}
    </div>
  </div>
  {% else %}
  <div class="panel panel-primary">
    <div class="panel-heading clearfix">
      <h4 class="panel-title pull-left">You haven't uploaded any files yet.</h4>
    </div>
  </div>
  {% endfor %}

  {% else %}
  Welcome to the application tester! In order to use it and upload files, you need to first register an account.
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="{{url_for('static', filename='scripts.js')}}"></script>
{% endblock %}
